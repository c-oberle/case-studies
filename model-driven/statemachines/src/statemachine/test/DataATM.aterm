CompilationUnit(
  [ PackageDec([], PackageName([Id("statemachine"), Id("test")]))
  , TypeImportDec(
      TypeName(
        PackageOrTypeName(PackageOrTypeName(Id("statemachine")), Id("data"))
      , Id("Metamodel")
      )
    )
  , TypeImportDec(
      TypeName(
        PackageOrTypeName(PackageOrTypeName(Id("entity")), Id("test"))
      , Id("Account")
      )
    )
  , Statemachine(
      [Public()]
    , Id("DataATM")
    , StatemachineBody(
        InitialState(Id("Init"))
      , [ PropertyData(
            [(Property(Id("acc"), SimpleSort(Id("Account"))), None())]
          )
        , PropertyData(
            [(Property(Id("pinCount"), SimpleSort(Id("Integer"))), None())]
          )
        ]
      , Events(
          [ ParametricEvent(Id("InsertCard"), [SimpleSort(Id("Account"))])
          , EventName(Id("Cancel"))
          , ParametricEvent(Id("Pin"), [SimpleSort(Id("String"))])
          , ParametricEvent(Id("Amount"), [SimpleSort(Id("Integer"))])
          , EventName(Id("MoneyTaken"))
          , EventName(Id("CardTaken"))
          , EventName(Id("CardRevoked"))
          ]
        )
      , [ State(
            Id("Init")
          , [ Transition(
                ParametricEvent(Id("InsertCard"), [Id("clientAcc")])
              , WithEffect(
                  Id("Withdraw")
                , [ Assignment(Var(Id("acc")), Var(Id("clientAcc")))
                  , Assignment(Var(Id("pinCount")), Int("0"))
                  ]
                )
              )
            , Transition(NamedEvent(Id("Cancel")), Id("Init"))
            ]
          )
        , State(
            Id("Withdraw")
          , [ Transition(
                WithCondition(
                  ParametricEvent(Id("Pin"), [Id("p")])
                , Eq(
                    Var(Id("p"))
                  , FieldAccess(Var(Id("acc")), Id("pin"))
                  )
                )
              , Id("HowMuch")
              )
            , Transition(
                WithCondition(
                  ParametricEvent(Id("Pin"), [Id("p")])
                , And(
                    SmallerThan(Var(Id("pinCount")), Int("2"))
                  , NotEq(
                      Var(Id("p"))
                    , FieldAccess(Var(Id("acc")), Id("pin"))
                    )
                  )
                )
              , WithEffect(
                  Id("Withdraw")
                , [ Assignment(
                      Var(Id("pinCount"))
                    , Add(Var(Id("pinCount")), Int("1"))
                    )
                  ]
                )
              )
            , Transition(
                WithCondition(
                  ParametricEvent(Id("Pin"), [Id("p")])
                , And(
                    LargerThanOrEqual(Var(Id("pinCount")), Int("2"))
                  , NotEq(
                      Var(Id("p"))
                    , FieldAccess(Var(Id("acc")), Id("pin"))
                    )
                  )
                )
              , Id("RevokeCard")
              )
            , Transition(NamedEvent(Id("Cancel")), Id("ReturnCard"))
            ]
          )
        , State(
            Id("HowMuch")
          , [ Transition(
                WithCondition(
                  ParametricEvent(Id("Amount"), [Id("amount")])
                , SmallerThan(
                    Var(Id("amount"))
                  , FieldAccess(Var(Id("acc")), Id("balance"))
                  )
                )
              , WithEffect(
                  Id("GiveMoney")
                , [ Assignment(
                      FieldAccess(Var(Id("acc")), Id("balance"))
                    , Sub(
                        FieldAccess(Var(Id("acc")), Id("balance"))
                      , Var(Id("amount"))
                      )
                    )
                  ]
                )
              )
            , Transition(NamedEvent(Id("Cancel")), Id("ReturnCard"))
            ]
          )
        , State(
            Id("GiveMoney")
          , [Transition(NamedEvent(Id("MoneyTaken")), Id("ReturnCard"))]
          )
        , State(
            Id("ReturnCard")
          , [ Transition(
                NamedEvent(Id("CardTaken"))
              , WithEffect(
                  Id("Init")
                , [Assignment(Var(Id("acc")), Null())]
                )
              )
            ]
          )
        , State(
            Id("RevokeCard")
          , [ Transition(
                NamedEvent(Id("CardRevoked"))
              , WithEffect(
                  Id("Init")
                , [Assignment(Var(Id("acc")), Null())]
                )
              )
            ]
          )
        ]
      )
    )
  ]
)